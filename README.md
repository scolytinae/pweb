# Дошел и я наконец до WireGuard

Чтобы не настраивать каждый раз все руками с нуля сделаем `ansible-playbook`.
Итого по шагам:

0. Нужны будут `docker`, `ansible` и ключ, для подключения к `ssh` сервера.
    Создаем себе (если почему-то не было до этого) пару ключей командой:

    ```bash
    ssh-keygen -t rsa
    ```

1. Мне нравится [этот хостинг](https://timeweb.cloud/), но можно и любой другой
    (правда может быть сложнее настроить доступ на сервер по ключу).
    Создаем там облачный сервер убунты в нужной локации и с желаемой
    конфигурацией. Отключаем бэкапы. И не забываем про публичный `ip`.
    Добавляем открытый ключ для доступа к серверу по `ssh`. И запрещаем 
    доступ по SSH с помощью пароля (они после *п.0* должны лежать в `~/.ssh/` 
    под именами: `*.pub` - открытый ключ и такой же файл без расширения - закрытый)

2. В папке `playbooks` создаем файл `inventory.yml` такой же как,
    `inventory-example.yml` но с нужными настройками.
    В поле `ansible_ssh_private_key_file` пишем путь до своего приватного ключа.
    Вместо <ip-address> - `ip`-адрес облачного сервера
    В поле `wg_password_hash` - хэш пароля. Сгенерировать его можно командой

    ```bash
    docker run --rm ghcr.io/wg-easy/wg-easy wgpw yourpassword
    ```

    **Внимательно!** Все символы `$` надо заменить на `$$` ибо экранирование.

3. После этого идем из папки `playbooks` запускаем команду

    ```bash
    ansible-playbook pweb.yml
    ```

    Если все прошло хорошо, то в браузере теперь можно по адресу `http://<your-server-ip>:51821/`
    найти веб-морду для `WireGuard`. Заходим с паролем из предыдущего пункта и добавляем 
    пользователей (через `QR`-коды очень даже удобно)